<!DOCTYPE html>
<html lang="en">

<head>
    <title>지도 올인원 | 어드민페이지</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css"
    rel="stylesheet">
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <style>
        /*
        DEMO STYLE
    */
    
    
    body {
        font-family: 'Nanum Gothic', sans-serif;
        background: #fafafa;
    }
    
    p {
        font-family: 'Nanum Gothic', sans-serif;
        font-size: 1.1em;
        font-weight: 300;
        line-height: 1.7em;
        color: #999;
    }
    
    a,
    a:hover,
    a:focus {
        color: inherit;
        text-decoration: none;
        transition: all 0.3s;
    }
    
    /* .navbar {
        padding: 15px 10px;
        background: #fff;
        border: none;
        border-radius: 0;
        margin-bottom: 40px;
        box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .navbar-btn {
        box-shadow: none;
        outline: none !important;
        border: none;
    } */
    
    .line {
        width: 100%;
        height: 1px;
        border-bottom: 1px dashed grey;
        margin: 40px 0;
    }
    
    i,
    span {
        display: inline-block;
    }
    
    /* ---------------------------------------------------
        NAVBAR STYLE
    ----------------------------------------------------- */
    
    header{
        height: 50px;
        z-index: 999;
        position: -webkit-sticky; /* 사파리 브라우저 지원 */
        position: sticky !important;
        top: 0px;
        color:white;
        background-color: #1f3c73;
    }
    
    /* ---------------------------------------------------
        SIDEBAR STYLE
    ----------------------------------------------------- */
    
    .wrapper {
        display: flex;
        width: 100%;
    }
    
    #sidebar {
        width: 180px;
        position: fixed;
        top: 50px;
        left: 0;
        height: 100vh;
        z-index: 400;
        background: #ffffff;
        color: black;
        transition: all 0.3s;
        border-right: 1px solid black;
    }
    
    /* #sidebar.active {
        min-width: 80px;
        max-width: 80px;
        text-align: center;
    }
    
    #sidebar.active .sidebar-header h3,
    #sidebar.active .CTAs {
        display: none;
    }
    
    #sidebar.active .sidebar-header strong {
        display: block;
    } */
    
    /* #sidebar ul li {
        height: 2.9em;
    } */
    
    #sidebar ul li.active {
        background: #dadadac2;
    }
    
    #sidebar ul li a {
        text-align: left;
    }
    
    /* #sidebar.active ul li a {
        padding: 20px 10px;
        text-align: center;
        font-size: 0.85em;
    }
    
    #sidebar.active ul li a i {
        margin-right: 0;
        display: block;
        font-size: 1.8em;
        margin-bottom: 5px;
    }
    
    #sidebar.active ul ul a {
        padding: 10px !important;
    }
    
    #sidebar.active .dropdown-toggle::after {
        top: auto;
        bottom: 10px;
        right: 50%;
        -webkit-transform: translateX(50%);
        -ms-transform: translateX(50%);
        transform: translateX(50%);
    } */
    
    /* #sidebar .sidebar-header {
        padding: 20px;
        background: #6d7fcc;
    }
    
    #sidebar .sidebar-header strong {
        display: none;
        font-size: 1.8em;
    } */
    
    #sidebar ul.components {
        padding: 20px 0;
        border-bottom: 1px solid #47748b;
    }
    
    #sidebar ul li a {
        padding: 10px;
        font-size: 1.1em;
        display: block;
    }
    
    #sidebar ul li a.focused {
        font-weight: bold;
    }
    
    #sidebar ul li a:hover {
        color: #7386D5;
        background: #fff;
    }
    
    #sidebar ul li a i {
        margin-right: 10px;
    }
    
    #sidebar ul li.active>a,
    a[aria-expanded="true"] {
        color: #fff;
        /* background: grey; */
    }
    
    a[data-toggle="collapse"] {
        position: relative;
    }
    
    #sidebar .dropdownBtn{
        position: absolute; 
        top:0; 
        right:-40px; 
        height: 100%; 
        width: 40px; 
        color:black
    }
    
    .dropdown-toggle{
        position: absolute;
    }
    
    .dropdown-toggle::after {
        display: block;
        position: absolute;
        top: 70%;
        right: 20px;
        transform: translateY(-50%);
    }
    
    ul ul a {
        font-size: 0.9em !important;
        padding-left: 30px !important;
        
    }
    
    a.article,
    a.article:hover {
        background: #dadadac2 !important;
        color: #fff !important;
    }
    
    
    
    /* ---------------------------------------------------
        CONTENT STYLE
    ----------------------------------------------------- */
    
    #content {
        width: calc(100% - 180px);
        left: 180px ;
        position:relative;
        padding: 20px;
        min-height: 100vh;
        transition: all 0.3s;
    }
    #content .edit{
        text-decoration: underline;
        color:skyblue;
    }
    #content .edit:hover{
        color: blue;
        cursor : pointer;
    }
    #content .hideButtons{
        display: none;
    }
    #content #addBuildings {
        text-align: center; 
        background-color: #6161618a;
    }
    #content #addBuildings:hover {
        cursor: pointer;
        opacity: 0.7;
    }
    
    /* ---------------------------------------------------
        MEDIAQUERIES
    ----------------------------------------------------- */
    /* 
    @media (max-width: 768px) {
        #sidebar {
            min-width: 80px;
            max-width: 80px;
            text-align: center;
            margin-left: -80px !important;
        }
        .dropdown-toggle::after {
            top: auto;
            bottom: 10px;
            right: 50%;
            -webkit-transform: translateX(50%);
            -ms-transform: translateX(50%);
            transform: translateX(50%);
        }
        #sidebar.active {
            margin-left: 0 !important;
        }
        #sidebar .sidebar-header h3,
        #sidebar .CTAs {
            display: none;
        }
        #sidebar .sidebar-header strong {
            display: block;
        }
        #sidebar ul li a {
            padding: 20px 10px;
        }
        #sidebar ul li a span {
            font-size: 0.85em;
        }
        #sidebar ul li a i {
            margin-right: 0;
            display: block;
        }
        #sidebar ul ul a {
            padding: 10px !important;
        }
        #sidebar ul li a i {
            font-size: 1.3em;
        }
        #sidebar {
            margin-left: 0;
        }
        #sidebarCollapse span {
            display: none;
        }
    } */
      </style>
    <header class="navbar navbar-expand flex-column flex-md-row bd-navbar">
        <a class="navbar-brand mr-0 mr-md-2" href="/admin" >지도올인원 Admin Page</a>
      
        <!-- <div class="navbar-nav-scroll">
          <ul class="navbar-nav bd-navbar-nav flex-row">
            <li class="nav-item">
              <a class="nav-link " href="/" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Bootstrap');">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/docs/4.4/getting-started/introduction/" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Docs');">Documentation</a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="/docs/4.4/examples/" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Examples');">Examples</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://icons.getbootstrap.com/" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Icons');">Icons</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://themes.getbootstrap.com/" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Themes');" target="_blank" rel="noopener">Themes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://expo.getbootstrap.com/" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Expo');" target="_blank" rel="noopener">Expo</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://blog.getbootstrap.com/" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Blog');" target="_blank" rel="noopener">Blog</a>
            </li>
          </ul>
        </div> -->
      </header>
    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar" class="" style="overflow: scroll;">

            <ul class="list-unstyled components">
                <li class="" id = "list_sinchon">
                    <div style="position: relative; width: calc(100% - 40px);">
                        <a href="/admin/sinchon/main" class="" id = "sinchon_main">
                            신촌캠퍼스
                        </a>
                        <a href="#sinchon" data-toggle="collapse" aria-expanded="false"id = "sinchon_dropdown" class="dropdownBtn" >▼</a>
                    </div>
                    <script>
                    </script>
                    <ul class="collapse list-unstyled" id="sinchon">
                        <% Object.keys(buildingData['sinchon']).forEach((i)=>{ %>
                            <li>
                                <a href="/admin/sinchon/<%=buildingData['sinchon'][i].BID%>" id = "sinchon_<%=buildingData['sinchon'][i].BID%>"><%=buildingData['sinchon'][i].BNAME%></a>
                            </li>
                        <% }) %>
                    </ul>
                </li>
                <li class="" id = "list_songdo">
                    <div style="position: relative; width: calc(100% - 40px);">
                        <a href="/admin/songdo/main" class="" id = "songdo_main">
                            송도캠퍼스
                        </a>
                        <a href="#songdo" data-toggle="collapse" aria-expanded="false"  id = "songdo_dropdown" class="dropdownBtn">▼</a>
                    </div>
                    <ul class="collapse list-unstyled" id="songdo">
                        <% Object.keys(buildingData['songdo']).forEach((i)=>{ %>
                            <li>
                                <a href="/admin/songdo/<%=buildingData['songdo'][i].BID%>" id = "songdo_<%=buildingData['songdo'][i].BID%>"><%=buildingData['songdo'][i].BNAME%></a>
                            </li>
                        <% }) %>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- Page Content  -->
        <div id="content">

            <!-- <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <svg class="svg-inline--fa fa-align-left fa-w-14" aria-hidden="true" data-prefix="fas" data-icon="align-left" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M288 44v40c0 8.837-7.163 16-16 16H16c-8.837 0-16-7.163-16-16V44c0-8.837 7.163-16 16-16h256c8.837 0 16 7.163 16 16zM0 172v40c0 8.837 7.163 16 16 16h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16zm16 312h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm256-200H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16h256c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16z"></path></svg><i class="fas fa-align-left"></i>
                        <span>Toggle Sidebar</span>
                    </button>
                    <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <svg class="svg-inline--fa fa-align-justify fa-w-14" aria-hidden="true" data-prefix="fas" data-icon="align-justify" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M0 84V44c0-8.837 7.163-16 16-16h416c8.837 0 16 7.163 16 16v40c0 8.837-7.163 16-16 16H16c-8.837 0-16-7.163-16-16zm16 144h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 256h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0-128h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg><i class="fas fa-align-justify"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item active">
                                <a class="nav-link" href="#">Page</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Page</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Page</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Page</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav> -->
            
            <h2><%if (campus == "sinchon"){ %> 신촌캠퍼스 <%}else{%> 송도캠퍼스 <%}%></h2>
            <h5>건물 리스트</h5>
            <table id = "building_list" class="table table-striped" style="font-size: 0.9em; table-layout: fixed; word-break:break-all; ">
                <thead class="thead-dark">
                  <tr>
                    <th scope="col" style="width: 86px;">건물번호</th>
                    <th scope="col" style="width: 170px;">이름</th>
                    <th scope="col" style="width: 100px;">운영시간(학기주중)</th>
                    <th scope="col" style="width: 100px;">운영시간(학기주말)</th>
                    <th scope="col" style="width: 100px;">운영시간(방학주중)</th>
                    <th scope="col" style="width: 100px;">운영시간(방학주말)</th>
                    <th scope="col" style="width: 100px;">지도내 좌표</th>
                    <th scope="col" style="width: 100px;">건물정보</th>
                    <th scope="col" style="width: 100px;">수정하기</th>
                  </tr>
                </thead>
                <tbody>
                    <% Object.keys(buildingData[campus]).forEach((i)=>{ %>
                    <tr id = "row_<%=i%>">
                        <th scope="row"><%=buildingData[campus][i].BID%></th>
                        <td><%=buildingData[campus][i].BNAME%></td>
                        <td><%=buildingData[campus][i].BTIME_SEM_DAY%></td>
                        <td><%=buildingData[campus][i].BTIME_SEM_END%></td>
                        <td><%=buildingData[campus][i].BTIME_VAC_DAY%></td>
                        <td><%=buildingData[campus][i].BTIME_VAC_END%></td>
                        <td><%=buildingData[campus][i].BAREA%></td>
                        <td><%=buildingData[campus][i].BETC%></td>
                        <td id = "editCell_<%=i%>"><span class=""><a class="edit editBuilding">수정</a> | <a class="edit deleteBuilding">삭제</a></span><span class="hideButtons"><a class="edit saveBuilding ">저장</a> | <a class="edit cancelEdit ">취소</a></span></td>
                    </tr>
                    <% }) %>
                    <tr>
                        <th scope="row" colspan="9" id = "addBuildings" >건물 추가하기</td>
                    </tr>
                </tbody>
              </table>
            
            <!-- <h2>Collapsible Sidebar Using Bootstrap 4</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <div class="line"></div>
            <h2>Lorem Ipsum Dolor</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <div class="line"></div>
            <h2>Lorem Ipsum Dolor</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <div class="line"></div>
            <h3>Lorem Ipsum Dolor</h3>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p> -->
        </div>
    </div>

  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  
  <!-- <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
  </script>
  
  <script type="text/javascript">
    
    let deleteBuildingFunc = async (e) => {
        e.preventDefault();
        e.stopPropagation();
        if(!confirm("삭제하시겠습니까?"))
            return;
        var raw = e.target.parentNode.parentNode.parentNode
        try {     
            const response = await fetch(`/api/<%=campus%>/building/${raw.cells[0].textContent}`, {
                method: 'DELETE', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, cors, *same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                    'Content-Type': 'application/json',
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrer: 'no-referrer', // no-referrer, *client
            });
            if(response.ok){
                // raw.cells[0].innerHTML = data.BID;
                // raw.cells[1].innerHTML = data.BNAME;
                // raw.cells[2].innerHTML = data.BOPENTIME;
                // raw.cells[3].innerHTML = data.BAREA;
                location.reload()
                // console.log('ok!', response.status, response.body, response.text());
            } else if (response.status == 403){
                alert("비정상적인 접근입니다.")
            } else {
                response.json().then((data)=>{
                    {
                        alert(data.code)
                    }
                })
                
                // console.log('fail!', response.status, response.body, response.json());
            }
            
        } catch(err) {
                console.error(`Error: ${err}`);
                }
    }
    let saveBuildingFunc = async (e) => {
        e.preventDefault();
        e.stopPropagation();
        if(!confirm("저장하시겠습니까?"))
            return;
        var raw = e.target.parentNode.parentNode.parentNode
        var data = {
            BID : raw.cells[0].textContent,
            BNAME : raw.cells[1].firstChild.value,
            BTIME_SEM_DAY : raw.cells[2].firstChild.value,
            BTIME_SEM_END : raw.cells[3].firstChild.value,
            BTIME_VAC_DAY : raw.cells[4].firstChild.value,
            BTIME_VAC_END : raw.cells[5].firstChild.value,
            BAREA : raw.cells[6].firstChild.value,
            BETC : raw.cells[7].firstChild.value,
        };
        // for (const [key, value] of Object.entries(data)) {
        //     if(value == ""){
        //         alert("데이터에 공백이 있을 순 없습니다.")
        //         return
        //     }
        // }
        try {
            const response = await fetch(`/api/<%=campus%>/building/${raw.cells[0].textContent}`, {
                method: 'PUT', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, cors, *same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                    'Content-Type': 'application/json',
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrer: 'no-referrer', // no-referrer, *client
                body: JSON.stringify(data), // body data type must match "Content-Type" header
                    });
            if(response.ok){
                // raw.cells[0].innerHTML = data.BID;
                // raw.cells[1].innerHTML = data.BNAME;
                // raw.cells[2].innerHTML = data.BOPENTIME;
                // raw.cells[3].innerHTML = data.BAREA;
                location.reload()
                // console.log('ok!', response.status, response.body, response.text());
            } else if (response.status == 403){
                alert("비정상적인 접근입니다.")
            } else  {
                response.json().then((data)=>{
                    if(data.code == "ER_DUP_ENTRY"){
                        alert("건물번호는 중복될 수 없습니다.")
                    } else if (data.code == "ER_PARSE_ERROR"){
                        alert("건물번호는 비워둘 수 없습니다.")
                    } else if (data.code == "ER_BAD_FIELD_ERROR"){
                        alert("건물번호는 숫자여야 합니다.")
                    } else {
                        alert(data.code)
                    }
                })
                
                // console.log('fail!', response.status, response.body, response.json());
            }
            
        } catch(err) {
                console.error(`Error: ${err}`);
                }
    }
    let cancelEditFunc = (e) => {
        e.preventDefault();
        e.stopPropagation();
        if(!confirm("취소하시겠습니까?"))
            return;
        var raw = e.target.parentNode.parentNode.parentNode
        var table = raw.parentNode.parentNode;
        for(var i = 1; i < table.rows[0].cells.length - 1; i++){
            
            raw.cells[i].removeChild(raw.cells[i].firstChild)
            raw.cells[i].innerHTML = tempEditVal[i]
        }
        raw.cells[table.rows[0].cells.length - 1].lastChild.classList.add("hideButtons")
        raw.cells[table.rows[0].cells.length - 1].firstChild.classList.remove("hideButtons")
        
        focusedEditRow = null;
        // var raw = e.target.parentNode.parentNode.parentNode
        // console.log(tempEditRaw, raw)
        // raw.parentNode.replaceChild(tempEditRaw, raw)
        // raw.parentNode.removeChild(raw);
        // document.getElementById('addBuildings').classList.remove("hideButtons")
    }
    var tempEditVal = {}
    var focusedEditRow = null;


    
    let editBuildingFunc = (e)=>{
        e.preventDefault();
        e.stopPropagation();
        var raw = e.target.parentNode.parentNode.parentNode;
        // console.log(raw)
        var table = raw.parentNode.parentNode;
        
        if (focusedEditRow != null){
            document.getElementById('building_list').rows[focusedEditRow].cells[table.rows[0].cells.length - 1].lastChild.lastChild.click()
        }
        if (document.getElementsByClassName("cancelRegister").length > 0){
            document.getElementById('building_list').rows[table.rows.length-2].cells[table.rows[0].cells.length - 1].lastChild.lastChild.click()
        }
        focusedEditRow = raw.rowIndex;
        let temp = raw.cells
        for(var i = 1; i < table.rows[0].cells.length - 1; i++){
            var input = document.createElement("textarea")
            input.type = "text"
            input.name = `cell_${i}`
            input.style = "width: 100%;"
            input.value = temp[i].textContent
            
            tempEditVal[i] = temp[i].textContent
            // console.log(i, raw.cells[i], raw.cells[i].childElementCount, raw.cells[i].firstChild)
            if(tempEditVal[i] !== "")
                raw.cells[i].removeChild(raw.cells[i].firstChild)
            raw.cells[i].appendChild(input)
        }
        raw.cells[table.rows[0].cells.length - 1].firstChild.classList.add("hideButtons")
        raw.cells[table.rows[0].cells.length - 1].lastChild.classList.remove("hideButtons")
        
        // document.getElementById('addBuildings').classList.add("hideButtons")
    }
    
    
    
    let registerBuildingFunc = async (e) => {
        e.preventDefault();
        e.stopPropagation();
    
        if(!confirm("등록하시겠습니까?"))
            return;
        var raw = e.target.parentNode.parentNode.parentNode
        var data = {
            BID : raw.cells[0].firstChild.value,
            BNAME : raw.cells[1].firstChild.value,
            BTIME_SEM_DAY : raw.cells[2].firstChild.value,
            BTIME_SEM_END : raw.cells[3].firstChild.value,
            BTIME_VAC_DAY : raw.cells[4].firstChild.value,
            BTIME_VAC_END : raw.cells[5].firstChild.value,
            BAREA : raw.cells[6].firstChild.value,
            BETC : raw.cells[7].firstChild.value,
        };
        // for (const [key, value] of Object.entries(data)) {
        //     if(value == ""){
        //         alert("데이터에 공백이 있을 순 없습니다.")
        //         return
        //     }
        // }
        try {     
            const response = await fetch('/api/<%=campus%>/building', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, cors, *same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                    'Content-Type': 'application/json',
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrer: 'no-referrer', // no-referrer, *client
                body: JSON.stringify(data), // body data type must match "Content-Type" header
                    });
            if(response.ok){
                // raw.cells[0].innerHTML = data.BID;
                // raw.cells[1].innerHTML = data.BNAME;
                // raw.cells[2].innerHTML = data.BOPENTIME;
                // raw.cells[3].innerHTML = data.BAREA;
                location.reload()
                // console.log('ok!', response.status, response.body, response.text());
            } else if (response.status == 403){
                alert("비정상적인 접근입니다.")
            } else  {
                response.json().then((data)=>{
                    if(data.code == "ER_DUP_ENTRY"){
                        alert("건물번호는 중복될 수 없습니다.")
                    } else if (data.code == "ER_PARSE_ERROR"){
                        alert("건물번호는 비워둘 수 없습니다.")
                    } else {
                        alert(data.code)
                    }
                })
                
                // console.log('fail!', response.status, response.body, response.json());
            }
            
        } catch(err) {
                console.error(`Error: ${err}`);
                }
    }
    
    let cancelRegisterFunc = async (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        if(!confirm("취소하시겠습니까?"))
            return;
        var raw = e.target.parentNode.parentNode.parentNode
        raw.parentNode.removeChild(raw);
        document.getElementById('addBuildings').classList.remove("hideButtons")
    }
                    
    
    document.getElementById('addBuildings').addEventListener('click',(e)=>{
        e.preventDefault();
        e.stopPropagation();
        var tbody = e.target.parentNode.parentNode
        var row = tbody.insertRow(tbody.parentNode.rows.length-2)
        if (focusedEditRow != null){
            document.getElementById('building_list').rows[focusedEditRow].cells[tbody.parentNode.rows[0].cells.length - 1].lastChild.lastChild.click()
        }
        for(var i = 0; i < tbody.parentNode.rows[0].cells.length - 1; i++){
            var input = document.createElement("input")
            input.type = "text"
            input.name = `cell_${i}`
            input.style = "width: 100%;"
            row.insertCell(i).appendChild(input)
        }
        var a = document.createElement("a")
        a.className = "edit registerBuilding";
        a.innerHTML = "등록"
        a.addEventListener('click', registerBuildingFunc);
        
        var txt = document.createTextNode(" | ")
        var b = document.createElement("a")
        b.className = "edit cancelRegister";
        b.innerHTML = "취소"
        b.addEventListener('click', cancelRegisterFunc);
        var span = document.createElement("span")
        span.appendChild(a)
        span.appendChild(txt)
        span.appendChild(b)
        row.insertCell(tbody.parentNode.rows[0].cells.length - 1).appendChild(span)
        document.getElementById('addBuildings').classList.add("hideButtons")
    });
    window.onload = () =>{
        //Focus & Activate Effect
        document.getElementById('list_<%=campus%>').classList.add("active")
        let dbtn = document.getElementById('<%=campus%>_dropdown')
        dbtn.setAttribute("aria-expanded", "true");
        dbtn.classList.remove("collapsed");
        document.getElementById("<%=campus%>").classList.add("show")
        
        document.getElementById('<%=campus%>_<%=building%>').classList.add("focused")
        
        Array.prototype.forEach.call(document.getElementsByClassName("deleteBuilding"), el=>{
            
            el.addEventListener("click", deleteBuildingFunc)
        })
        Array.prototype.forEach.call(document.getElementsByClassName("editBuilding"), el=>{
            el.addEventListener("click", editBuildingFunc)
        })
        Array.prototype.forEach.call(document.getElementsByClassName("cancelEdit"), el=>{
            el.addEventListener("click", cancelEditFunc)
        })
        Array.prototype.forEach.call(document.getElementsByClassName("saveBuilding"), el=>{
            el.addEventListener("click", saveBuildingFunc)
        })
    
    }
</script>


</body>

</html>